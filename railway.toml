[build]
  builder = "nixpacks"

[phases.setup]
  nixPkgs = ["python311", "nodejs_20"]
  cmds = [
    "npm install -g pnpm",
    "cd web && pnpm install",
    "cd api && pip install -r requirements.txt"
  ]

[phases.build]
  cmds = [
    "cd web && pnpm build"
  ]

[[services]]
  name = "api"
  startCommand = "uvicorn api.main:app --host 0.0.0.0 --port $PORT"
  [services.envs]
    PORT = "8000"

[[services]]
  name = "web"
  startCommand = "cd web && pnpm start"
  [services.envs]
    PORT = "3000"

